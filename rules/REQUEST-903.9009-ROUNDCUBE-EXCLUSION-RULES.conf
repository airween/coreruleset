# ------------------------------------------------------------------------
# OWASP ModSecurity Core Rule Set ver.3.4.0-dev
# Copyright (c) 2021 Core Rule Set project. All rights reserved.
#
# The OWASP ModSecurity Core Rule Set is distributed under
# Apache Software License (ASL) version 2
# Please see the enclosed LICENSE file for full details.
# ------------------------------------------------------------------------

# These exclusions remedy false positives in a default RoundCube Webmail install.
# The exclusions are only active if crs_exclusions_roundcube=1 (installed instance)
# or the crs_exclusions_roundcube_installer=1 () is set.
# See rule 900130 in crs-setup.conf.example for instructions.

# As RoundCube uses only the "/" URI (or /index.php), therefore we do not use any
# variables in rules. Every exclusion triggered in case of all requests. Nonetheless
# we tried to classify the rules from the point of UX function - see the lines before
# rules.

SecRule &TX:crs_exclusions_roundcube|TX:crs_exclusions_roundcube "@eq 0" \
    "id:9009000,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ver:'OWASP_CRS/3.4.0-dev',\
    skipAfter:END-ROUNDCUBE"

SecRule &TX:crs_exclusions_roundcube|TX:crs_exclusions_roundcube "@eq 0" \
    "id:9009001,\
    phase:2,\
    pass,\
    t:none,\
    nolog,\
    ver:'OWASP_CRS/3.4.0-dev',\
    skipAfter:END-ROUNDCUBE"

# Basic exclusions - the next exclusions used for login
SecAction \
    "id:9009100,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=942421;REQUEST_COOKIES:_hjid,\
    ctl:ruleRemoveTargetById=920273;ARGS:_timezone,\
    ctl:ruleRemoveTargetById=920273;REQUEST_BODY,\
    ctl:ruleRemoveTargetById=921170;ARGS_NAMES:_task"

# Exclusions for reading a mail
SecAction \
    "id:9009101,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=942432;ARGS:_caps,\
    ctl:ruleRemoveTargetById=920273;ARGS:_email"

# Exclusions for settings
SecAction \
    "id:9009102,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=920272;ARGS,\
    ctl:ruleRemoveTargetById=920273;ARGS,\
    ctl:ruleRemoveTargetById=920272;REQUEST_BODY"

# Exclusions for sending e-mail
SecAction \
    "id:9009103,\
    phase:1,\
    pass,\
    t:none,\
    nolog,\
    ctl:ruleRemoveTargetById=921170;ARGS_NAMES:_framed,\
    ctl:ruleRemoveTargetById=942130;ARGS:_message,\
    ctl:ruleRemoveTargetById=942130;ARGS:_subject,\
    ctl:ruleRemoveTargetById=942440;ARGS:_message,\
    ctl:ruleRemoveTargetById=942431;ARGS:_message,\
    ctl:ruleRemoveTargetById=942432;ARGS:_message,\
    ctl:ruleRemoveTargetById=942432;ARGS:_subject,\
    ctl:ruleRemoveTargetById=942460;ARGS:_message"

SecMarker "END-ROUNDCUBE"
